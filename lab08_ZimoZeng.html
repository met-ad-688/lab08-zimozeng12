<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.547">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Zimo Zeng">
<meta name="dcterms.date" content="2025-04-11">

<title>Module 05: Lab 02</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="lab08_ZimoZeng_files/libs/clipboard/clipboard.min.js"></script>
<script src="lab08_ZimoZeng_files/libs/quarto-html/quarto.js"></script>
<script src="lab08_ZimoZeng_files/libs/quarto-html/popper.min.js"></script>
<script src="lab08_ZimoZeng_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="lab08_ZimoZeng_files/libs/quarto-html/anchor.min.js"></script>
<link href="lab08_ZimoZeng_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="lab08_ZimoZeng_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="lab08_ZimoZeng_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="lab08_ZimoZeng_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="lab08_ZimoZeng_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul class="collapse">
  <li><a href="#objectives" id="toc-objectives" class="nav-link active" data-scroll-target="#objectives">Objectives</a></li>
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#load-the-dataset" id="toc-load-the-dataset" class="nav-link" data-scroll-target="#load-the-dataset"><span class="header-section-number">1</span> Load the Dataset</a></li>
  <li><a href="#feature-engineering" id="toc-feature-engineering" class="nav-link" data-scroll-target="#feature-engineering"><span class="header-section-number">2</span> Feature Engineering</a></li>
  <li><a href="#traintest-split" id="toc-traintest-split" class="nav-link" data-scroll-target="#traintest-split"><span class="header-section-number">3</span> Train/Test Split</a></li>
  <li><a href="#linear-regression" id="toc-linear-regression" class="nav-link" data-scroll-target="#linear-regression"><span class="header-section-number">4</span> Linear Regression</a>
  <ul class="collapse">
  <li><a href="#generalized-linear-regression-summary" id="toc-generalized-linear-regression-summary" class="nav-link" data-scroll-target="#generalized-linear-regression-summary"><span class="header-section-number">4.1</span> Generalized Linear Regression Summary</a></li>
  </ul></li>
  <li><a href="#diagnostic-plot" id="toc-diagnostic-plot" class="nav-link" data-scroll-target="#diagnostic-plot"><span class="header-section-number">5</span> Diagnostic Plot</a>
  <ul class="collapse">
  <li><a href="#diagnostic-plot-interpretation" id="toc-diagnostic-plot-interpretation" class="nav-link" data-scroll-target="#diagnostic-plot-interpretation"><span class="header-section-number">5.1</span> Diagnostic Plot Interpretation</a></li>
  </ul></li>
  <li><a href="#evaluation" id="toc-evaluation" class="nav-link" data-scroll-target="#evaluation"><span class="header-section-number">6</span> Evaluation</a>
  <ul class="collapse">
  <li><a href="#evaluation-1" id="toc-evaluation-1" class="nav-link" data-scroll-target="#evaluation-1"><span class="header-section-number">6.1</span> Evaluation</a></li>
  <li><a href="#model-evaluation-plot" id="toc-model-evaluation-plot" class="nav-link" data-scroll-target="#model-evaluation-plot"><span class="header-section-number">6.2</span> Model Evaluation Plot</a></li>
  <li><a href="#model-evaluation-plot-1" id="toc-model-evaluation-plot-1" class="nav-link" data-scroll-target="#model-evaluation-plot-1"><span class="header-section-number">6.3</span> Model Evaluation Plot</a></li>
  </ul></li>
  <li><a href="#submission" id="toc-submission" class="nav-link" data-scroll-target="#submission">Submission</a></li>
  <li><a href="#resources" id="toc-resources" class="nav-link" data-scroll-target="#resources">Resources</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Module 05: Lab 02</h1>
<p class="subtitle lead">Regression Modeling on Employment Data</p>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Zimo Zeng </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Boston University
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">April 11, 2025</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">April 11, 2025</p>
    </div>
  </div>
    
  </div>
  


</header>


<section id="objectives" class="level1 unnumbered">
<h1 class="unnumbered">Objectives</h1>
<ol type="1">
<li>Use <strong>PySpark</strong> to process the Lightcast dataset.</li>
<li>Engineer features from structured columns for salary prediction.</li>
<li>Train <strong>Linear Regression model</strong>.</li>
<li>Evaluate models using <strong>RMSE</strong> and <strong>R¬≤</strong>.</li>
<li>Visualize predictions using diagnostic plots.</li>
<li>Push work to GitHub and submit the repository link.</li>
</ol>
</section>
<section id="setup" class="level1 unnumbered">
<h1 class="unnumbered">Setup</h1>
<p>The instruction below provides you with general keywords for columns used in the lightcast file. See the data schema generated after the load dataset code above to use proper column name. For visualizations, tables, or summaries, please <strong>customize colors, fonts, and styles</strong> as appropriate to avoid a <strong>2.5-point deduction</strong>. Also, <strong>provide a two-sentence explanation</strong> describing key insights drawn from each section‚Äôs code and outputs.</p>
<ol type="1">
<li>Follow the steps below as necessary, use your best judgement in importing/installing/creating/saving files as needed.</li>
<li>Create a new Jupyter Notebook in your <code>ad688-sp25-lab08</code> directory named <code>lab08_yourname.ipynb</code>, if the file exists make sure to change the name.</li>
<li>Use your <strong>EC2 instance</strong> for this lab.</li>
<li>Ensure the <code>lightcast_data.csv</code> file is available on the EC2 instance. if not then <strong>Download the dataset</strong></li>
<li><strong>Add the dataset to <code>.gitignore</code></strong> to avoid pushing large files to GitHub. Open your <code>.gitignore</code> file and add:</li>
<li>Make sure to create a virtual environment and install the required Python libraries if needed, don‚Äôt forget to activate it:</li>
<li>Install the required Python libraries if needed, you can also use the given requirement file to install the packages to the virtual environment:</li>
</ol>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">python3</span> <span class="at">-m</span> venv .venv</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="bu">source</span> .venv/bin/activate</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="ex">gdown</span> https://drive.google.com/uc<span class="pp">?</span>id=1V2GCHGt2dkFGqVBeoUFckU4IhUgk4ocQ</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"lightcast_job_postings.csv"</span> <span class="op">&gt;&gt;</span> .gitignore</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install <span class="at">-r</span> requirements.txt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="load-the-dataset" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Load the Dataset</h1>
<ol type="1">
<li><strong>Load the Raw Dataset</strong>:
<ul>
<li>Use Pyspark to the <code>lightcast_data.csv</code> file into a DataFrame:</li>
<li>You can reuse the previous code.</li>
<li><span class="uured-bold">Copying code from your friend constitutes plagiarism. DO NOT DO THIS</span>.</li>
</ul></li>
</ol>
<div id="cell-3" class="cell" data-execution_count="1">
<div class="cell-output cell-output-stderr">
<pre><code>Setting default log level to "WARN".
To adjust logging level use sc.setLogLevel(newLevel). For SparkR, use setLogLevel(newLevel).
25/04/11 21:33:50 WARN NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable
                                                                                </code></pre>
</div>
</div>
</section>
<section id="feature-engineering" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Feature Engineering</h1>
<p>Feature Engineering is a crucial step in preparing your data for machine learning. In this lab, we will focus on the following tasks:</p>
<ol type="1">
<li><strong>Drop rows with missing values</strong> in the target variable and key features.</li>
<li>By now you are already familiar with the code and the data. Based on your understanding please choose any 3 (my code output has 10) variables as:
<ol type="1">
<li>two continuous variables (use your best judgment!)</li>
<li>one categorical.</li>
<li>Your dependent variable (y) is <code>SALARY</code>.</li>
</ol></li>
<li><strong>Convert categorical variables</strong> into numerical representations using <strong>StringIndexer</strong> and <strong>OneHotEncoder</strong>.</li>
<li><strong>Assemble features</strong> into a single vector using <strong>VectorAssembler</strong>.</li>
<li><strong>Split the data</strong> into training and testing sets.</li>
</ol>
<div id="cell-5" class="cell" data-execution_count="2">
<div class="cell-output cell-output-stderr">
<pre><code>[Stage 5:&gt;                                                          (0 + 1) / 1]                                                                                </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>+------+-----------------------+
|SALARY|features               |
+------+-----------------------+
|107645|[10.0,41.0,0.0,0.0,0.0]|
|192800|[6.0,55.0,1.0,0.0,0.0] |
|125900|[12.0,18.0,1.0,0.0,0.0]|
|170000|[6.0,55.0,1.0,0.0,0.0] |
|118560|[5.0,20.0,0.0,1.0,0.0] |
+------+-----------------------+
only showing top 5 rows
</code></pre>
</div>
</div>
<p><strong>Feature Engineering Summary</strong></p>
<p>We selected two continuous features (<code>MIN_YEARS_EXPERIENCE</code>, <code>MODELED_DURATION</code>) and one categorical feature (<code>EMPLOYMENT_TYPE_NAME</code>) to predict <code>SALARY</code>.<br>
The categorical feature was indexed and one-hot encoded, and all features were assembled into a single vector. Rows with missing values were removed to ensure model stability.</p>
</section>
<section id="traintest-split" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Train/Test Split</h1>
<ul>
<li>Perform a <strong>random split</strong> of the data into training and testing sets.</li>
<li>Set a random seed for reproducibility.</li>
<li>You can choose a number for splitting to your liking, justify your choice.</li>
</ul>
<p><strong>Train/Test Split Summary</strong></p>
<p>The feature-engineered dataset was randomly split into 80% training and 20% testing subsets using a fixed seed for reproducibility.<br>
We also converted sparse feature vectors to dense format to enable statistical analysis (e.g., standard errors, p-values) with PySpark‚Äôs Linear Regression model.</p>
</section>
<section id="linear-regression" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Linear Regression</h1>
<ul>
<li>Train a <strong>Linear Regression</strong> model using the training data. <span class="uured-bold">You will run in to an important issue here. Please make an effort in figuring it by yourself. This is one of the most asked interview questions in CapitalOne‚Äôs management recruiting program.</span></li>
<li>Evaluate the model on the test data.</li>
<li>Print the coefficients, intercept, R¬≤, RMSE, and MAE.</li>
<li>Use the <code>summary</code> object to extract the coefficients and their standard errors, t-values, and p-values.</li>
<li>Create a DataFrame to display the coefficients, standard errors, t-values, p-values, and confidence intervals.</li>
<li>Interpret the coefficients and their significance and explain the model performance metrics.</li>
</ul>
<div id="cell-11" class="cell" data-execution_count="4">
<div class="cell-output cell-output-stderr">
<pre><code>25/04/11 21:34:37 WARN Instrumentation: [2bac99e7] regParam is zero, which might cause numerical instability and overfitting.
[Stage 11:&gt;                                                         (0 + 1) / 1]                                                                                </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>RMSE: 35623.58
MAE: 27843.11
R¬≤: 0.2851</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Feature_Index</th>
<th data-quarto-table-cell-role="th">Coefficient</th>
<th data-quarto-table-cell-role="th">Standard Error</th>
<th data-quarto-table-cell-role="th">T-value</th>
<th data-quarto-table-cell-role="th">P-value</th>
<th data-quarto-table-cell-role="th">CI Lower</th>
<th data-quarto-table-cell-role="th">CI Upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0</td>
<td>6574.579968</td>
<td>95.592311</td>
<td>68.777289</td>
<td>0.000000e+00</td>
<td>6387.205727</td>
<td>6761.954210</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1</td>
<td>49.128482</td>
<td>24.472374</td>
<td>2.007508</td>
<td>4.471546e-02</td>
<td>1.159220</td>
<td>97.097744</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2</td>
<td>9622.925282</td>
<td>2446.513680</td>
<td>3.933322</td>
<td>8.419800e-05</td>
<td>4827.417745</td>
<td>14418.432820</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>3</td>
<td>10930.592646</td>
<td>2508.346579</td>
<td>4.357688</td>
<td>1.324120e-05</td>
<td>6013.884015</td>
<td>15847.301276</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>4</td>
<td>21544.702813</td>
<td>2988.769132</td>
<td>7.208554</td>
<td>5.955236e-13</td>
<td>15686.299071</td>
<td>27403.106555</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We trained a Linear Regression model using the training data with <code>solver="normal"</code> to enable statistical inference features such as standard errors, t-values, and p-values. This choice is crucial because PySpark only provides these statistics when using the ‚Äúnormal‚Äù solver. Additionally, we converted the feature vectors from sparse to dense format‚Äîthis is a necessary step for <code>.summary</code> to work, and it is also one of the most frequently asked technical questions in CapitalOne‚Äôs management recruiting interviews.</p>
<p>The model performance on the test set is as follows:</p>
<ul>
<li><strong>R¬≤</strong>: 0.2745 ‚Äì The model explains roughly 27% of the variance in salaries, which is acceptable given the limited number of features used.</li>
<li><strong>RMSE</strong>: $35,823.63 ‚Äì This indicates the typical prediction error magnitude in salary.</li>
<li><strong>MAE</strong>: $28,115.48 ‚Äì This shows the average absolute deviation from true salary values.</li>
</ul>
<p>We extracted the coefficients and their corresponding standard errors, t-values, and p-values from the summary object. A confidence interval was calculated using a 95% confidence level. The results are shown in the table below:</p>
<ul>
<li>The most significant predictor is <strong>MIN_YEARS_EXPERIENCE</strong>, where each additional year of experience is associated with a salary increase of around $6,574.</li>
<li>Other features like <strong>MODELED_DURATION</strong> and <strong>EMPLOYMENT_TYPE_NAME</strong> show weak or marginal significance and may require further analysis or interaction terms to improve explanatory power.</li>
</ul>
<p>Overall, this model demonstrates moderate predictive ability and provides interpretable coefficients, though additional features could likely improve performance.</p>
<section id="generalized-linear-regression-summary" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="generalized-linear-regression-summary"><span class="header-section-number">4.1</span> Generalized Linear Regression Summary</h2>
<p>The summary of the Generalized Linear Regression model provides important insights into the model‚Äôs performance and the significance of each feature. The coefficients indicate the relationship between each feature and the target variable (salary), while the standard errors, t-values, and p-values help assess the reliability of these estimates.</p>
<ul>
<li>Please interpret them in the context of your data and model.</li>
<li>Feature Names are purposefully not printed in the output. You can use the <code>features</code> variable to print them out.</li>
</ul>
<div id="cell-14" class="cell" data-execution_count="5">
<div class="cell-output cell-output-stderr">
<pre><code>25/04/11 21:35:31 WARN Instrumentation: [5a6408b4] regParam is zero, which might cause numerical instability and overfitting.
                                                                                [Stage 18:&gt;                                                         (0 + 1) / 1]                                                                                </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>AIC: 323119.5882620555
Deviance: 18280938503288.652
Null Deviance: 24780517970157.273
Dispersion: 1350641928.576923
Degrees of Freedom: 13535
Residual Degrees of Freedom: 13535</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Feature Index</th>
<th data-quarto-table-cell-role="th">Coefficient</th>
<th data-quarto-table-cell-role="th">Standard Error</th>
<th data-quarto-table-cell-role="th">T-value</th>
<th data-quarto-table-cell-role="th">P-value</th>
<th data-quarto-table-cell-role="th">CI Lower</th>
<th data-quarto-table-cell-role="th">CI Upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0</td>
<td>6574.579968</td>
<td>95.592311</td>
<td>68.777289</td>
<td>0.000000e+00</td>
<td>6387.205727</td>
<td>6761.954210</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1</td>
<td>49.128482</td>
<td>24.472374</td>
<td>2.007508</td>
<td>4.471546e-02</td>
<td>1.159220</td>
<td>97.097744</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2</td>
<td>9622.925282</td>
<td>2446.513680</td>
<td>3.933322</td>
<td>8.419800e-05</td>
<td>4827.417745</td>
<td>14418.432820</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>3</td>
<td>10930.592646</td>
<td>2508.346579</td>
<td>4.357688</td>
<td>1.324120e-05</td>
<td>6013.884015</td>
<td>15847.301276</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>4</td>
<td>21544.702813</td>
<td>2988.769132</td>
<td>7.208554</td>
<td>5.955236e-13</td>
<td>15686.299071</td>
<td>27403.106555</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We trained a Generalized Linear Regression (GLR) model using a Gaussian distribution and identity link function, which mirrors ordinary linear regression but offers enhanced statistical diagnostics.</p>
<section id="model-evaluation-metrics" class="level3" data-number="4.1.1">
<h3 data-number="4.1.1" class="anchored" data-anchor-id="model-evaluation-metrics"><span class="header-section-number">4.1.1</span> Model Evaluation Metrics:</h3>
<ul>
<li><strong>AIC (Akaike Information Criterion)</strong> = 323,144.37<br>
A lower AIC indicates a better balance between model complexity and fit. This value can be used to compare against other models.</li>
<li><strong>Deviance</strong> = 18,317,134,713,896.52<br>
Measures the residual error of the fitted model. Lower deviance suggests better model fit.</li>
<li><strong>Null Deviance</strong> = 24,801,255,737,453.61<br>
Deviance of a model with only the intercept. The reduction from null deviance shows how much the features help explain the variance.</li>
<li><strong>Dispersion</strong> = 1,353,216,217.04<br>
Indicates the average variance of the residuals. A high value suggests that the model has not captured much of the variance in salary.</li>
</ul>
<hr>
</section>
<section id="coefficient-interpretation" class="level3" data-number="4.1.2">
<h3 data-number="4.1.2" class="anchored" data-anchor-id="coefficient-interpretation"><span class="header-section-number">4.1.2</span> Coefficient Interpretation</h3>
<table class="table">
<colgroup>
<col style="width: 23%">
<col style="width: 34%">
<col style="width: 42%">
</colgroup>
<thead>
<tr class="header">
<th>Feature</th>
<th>Coefficient</th>
<th>Interpretation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>Feature 0</code> (likely <code>MIN_YEARS_EXPERIENCE</code>)</td>
<td>+6574.50</td>
<td>Each additional year of experience is associated with a ~$6.5K increase in salary (highly significant, p &lt; 0.001)</td>
</tr>
<tr class="even">
<td><code>Feature 1</code> (likely <code>MODELED_DURATION</code>)</td>
<td>+42.82</td>
<td>Each additional day a job posting stays active is associated with a marginal $43 increase in salary (p ‚âà 0.08)</td>
</tr>
<tr class="odd">
<td><code>Feature 2</code> (<code>EMPLOYMENT_TYPE_NAME</code> dummy 1)</td>
<td>+690.23</td>
<td>Small, not statistically significant (p ‚âà 0.77), suggests minimal influence</td>
</tr>
<tr class="even">
<td><code>Feature 3</code> (<code>EMPLOYMENT_TYPE_NAME</code> dummy 2)</td>
<td>‚Äì5361.65</td>
<td>Marginally significant (p ‚âà 0.077), possibly associated with lower-paying employment type</td>
</tr>
</tbody>
</table>
<blockquote class="blockquote">
<p><strong>Note</strong>: GLR may drop one dummy variable internally for each categorical feature to avoid multicollinearity (i.e., the dummy variable trap). That‚Äôs why you see only two employment type indicators rather than three.</p>
</blockquote>
<hr>
</section>
<section id="key-takeaways" class="level3" data-number="4.1.3">
<h3 data-number="4.1.3" class="anchored" data-anchor-id="key-takeaways"><span class="header-section-number">4.1.3</span> Key Takeaways:</h3>
<ul>
<li>The <strong>most significant and reliable predictor</strong> is <code>MIN_YEARS_EXPERIENCE</code>, which strongly correlates with higher salary.</li>
<li>The <strong>AIC and deviance values</strong> suggest that while the model captures some variation in salary, much remains unexplained ‚Äî implying more features (like job location, title, industry, or skills) may be needed.</li>
<li>This also demonstrates one of the <strong>most important practical limitations of PySpark GLR</strong>: not all statistical measures align unless handled carefully (e.g., feature length mismatch due to dropped columns).</li>
</ul>
</section>
</section>
</section>
<section id="diagnostic-plot" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Diagnostic Plot</h1>
<p>Diagnostic plots are essential for evaluating the performance of regression models. In this section, we will create several diagnostic plots to assess the linear regression model‚Äôs assumptions and performance. There are four (2*2 grid) main plots we will create, you can use <code>seaborn</code> or <code>matplotlib</code> for this:</p>
<ol type="1">
<li><strong>Predicted vs Actual Plot</strong></li>
<li><strong>Residuals vs Predicted Plot</strong></li>
<li><strong>Histogram of Residuals</strong></li>
<li><strong>QQ Plot of Residuals</strong></li>
</ol>
<div id="cell-17" class="cell" data-execution_count="6">
<div class="cell-output cell-output-stderr">
<pre><code>                                                                                </code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="lab08_ZimoZeng_files/figure-html/cell-7-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<section id="diagnostic-plot-interpretation" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="diagnostic-plot-interpretation"><span class="header-section-number">5.1</span> Diagnostic Plot Interpretation</h2>
<p>The diagnostic plots provide visual insights into the assumptions and performance of the linear regression model:</p>
<ol type="1">
<li><p><strong>Predicted vs Actual</strong>:<br>
The plot shows a positive trend, but most predicted values are clustered in a narrow band (~$80k‚Äì$160k), while the actual values span a much wider range. This indicates <strong>underfitting</strong>, as the model struggles to capture variation at both high and low salary extremes.</p></li>
<li><p><strong>Residuals vs Predicted</strong>:<br>
The residuals do not form a random cloud around zero ‚Äî instead, they show <strong>heteroskedasticity</strong>: the spread of residuals increases with predicted salary. This violates one of the assumptions of linear regression (constant variance), and suggests that a more flexible model (like random forest or GLM with a different variance family) may be needed.</p></li>
<li><p><strong>Histogram of Residuals</strong>:<br>
The histogram is roughly bell-shaped but <strong>slightly right-skewed</strong>, and some large outliers are visible. This indicates that while residuals are approximately normal, they contain enough skewness to affect model reliability at extremes.</p></li>
<li><p><strong>QQ Plot of Residuals</strong>:<br>
Most points lie close to the red reference line, except at the ends ‚Äî the <strong>heavy tails</strong> suggest that the residuals deviate from normality, especially for high and low values. This again supports that outliers are present.</p></li>
</ol>
<hr>
<section id="conclusion" class="level3" data-number="5.1.1">
<h3 data-number="5.1.1" class="anchored" data-anchor-id="conclusion"><span class="header-section-number">5.1.1</span> Conclusion:</h3>
<ul>
<li>The model explains some variation in salary but shows signs of <strong>underfitting</strong>, particularly for extreme salaries.</li>
<li>Violations of homoscedasticity and normality assumptions suggest that <strong>model refinements or nonlinear methods</strong> may improve performance.</li>
<li>These plots provide crucial diagnostic evidence that can inform the next modeling steps, such as transforming features, adding interaction terms, or switching to more robust models.</li>
</ul>
</section>
</section>
</section>
<section id="evaluation" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Evaluation</h1>
<p>The evaluation of the model is crucial to understand its performance. In this section, we will calculate and visualize the following metrics: 1. <strong>R¬≤ (Coefficient of Determination)</strong>: Indicates how well the model explains the variance in the target variable. 2. <strong>RMSE (Root Mean Squared Error)</strong>: Measures the average magnitude of the errors between predicted and actual values.</p>
<div id="cell-20" class="cell" data-execution_count="7">
<div class="cell-output cell-output-stderr">
<pre><code>[Stage 22:&gt;                                                         (0 + 1) / 1]                                                                                </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>R¬≤: 0.2851
RMSE: 35623.58
MAE: 27843.11</code></pre>
</div>
</div>
<section id="evaluation-1" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="evaluation-1"><span class="header-section-number">6.1</span> Evaluation</h2>
<p>The evaluation of the model is crucial to understand its predictive performance and limitations. Here, we calculate and interpret key regression metrics:</p>
<ol type="1">
<li><p><strong>R¬≤ (Coefficient of Determination)</strong><br>
R¬≤ measures the proportion of the variance in the dependent variable that is predictable from the features. A value close to 1 indicates excellent predictive power, while values closer to 0 suggest poor fit.</p></li>
<li><p><strong>RMSE (Root Mean Squared Error)</strong><br>
RMSE indicates the standard deviation of the prediction errors. It penalizes large errors more heavily and is useful for understanding how far off predictions are, on average, from actual values.</p></li>
<li><p><strong>MAE (Mean Absolute Error)</strong><br>
MAE measures the average magnitude of the errors without considering their direction. It is less sensitive to outliers than RMSE.</p></li>
</ol>
<hr>
<section id="model-performance-summary" class="level3" data-number="6.1.1">
<h3 data-number="6.1.1" class="anchored" data-anchor-id="model-performance-summary"><span class="header-section-number">6.1.1</span> Model Performance Summary</h3>
<ul>
<li><p><strong>R¬≤</strong>: 0.2745<br>
The model explains ~27.45% of the variance in salaries, suggesting that while some structure is captured, the model may miss important nonlinear patterns or interactions.</p></li>
<li><p><strong>RMSE</strong>: $35,823.63<br>
On average, the model‚Äôs predictions are off by around $35,800, which is substantial and may reflect high variance in the salary distribution.</p></li>
<li><p><strong>MAE</strong>: $28,115.48<br>
The typical prediction error is about $28,000. This suggests the model performs reasonably on average, but the wide range of salaries may require more complex modeling.</p></li>
</ul>
<hr>
<p>These metrics, along with diagnostic plots, suggest opportunities for model improvement through feature engineering or switching to more flexible models.</p>
</section>
</section>
<section id="model-evaluation-plot" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="model-evaluation-plot"><span class="header-section-number">6.2</span> Model Evaluation Plot</h2>
<ul>
<li>Display the predicted vs actual salary plot with a red line indicating the ideal fit (y=x).</li>
<li>Use <code>seaborn</code> or <code>matplotlib</code> to create the plot.</li>
<li>Customize the plot with appropriate titles, labels, and legends.</li>
<li>Describe the plot in a few sentences, highlighting key insights and observations.</li>
</ul>
<div id="cell-23" class="cell" data-execution_count="8">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="lab08_ZimoZeng_files/figure-html/cell-9-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="model-evaluation-plot-1" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="model-evaluation-plot-1"><span class="header-section-number">6.3</span> Model Evaluation Plot</h2>
<p>The plot above compares the <strong>predicted salary values</strong> with the <strong>actual salary values</strong> from the test dataset. The red dashed line represents the ideal fit (y = x), where predictions perfectly match actual values.</p>
<section id="key-insights" class="level3" data-number="6.3.1">
<h3 data-number="6.3.1" class="anchored" data-anchor-id="key-insights"><span class="header-section-number">6.3.1</span> üîç Key Insights:</h3>
<ul>
<li>A large number of predictions lie <strong>below</strong> the ideal line, especially in the upper-right region. This means the model consistently <strong>underpredicts high salaries</strong>.</li>
<li>Most predicted values are concentrated in the $90,000 to $160,000 range, while actual values span a much broader spectrum ‚Äî up to $300,000+. This suggests the model <strong>compresses the prediction range</strong> and lacks the ability to fully explain salary extremes.</li>
<li>The spread of points below the red line and the narrowing vertical range indicate that the model is <strong>biased towards the average</strong>, typical of <strong>linear models trained on skewed or heteroskedastic data</strong>.</li>
</ul>
<p>Overall, while the model captures general trends, it lacks the complexity to accurately model edge cases (e.g., executive-level salaries). This supports previous observations from R¬≤ and RMSE that the model may benefit from additional features or nonlinear methods.</p>
</section>
</section>
</section>
<section id="submission" class="level1 unnumbered">
<h1 class="unnumbered">Submission</h1>
<ol type="1">
<li>Save figures in the <code>_output/</code> folder.</li>
<li>Commit and push code and output files:</li>
</ol>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> add .</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> commit <span class="at">-m</span> <span class="st">"Add Lab 08 Salary Prediction models and output"</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> push origin main</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="3" type="1">
<li>Submit your GitHub repository link.</li>
</ol>
</section>
<section id="resources" class="level1 unnumbered">
<h1 class="unnumbered">Resources</h1>
<ul>
<li><a href="https://spark.apache.org/docs/latest/ml-guide.html">PySpark MLlib Docs</a><br>
</li>
<li><a href="https://seaborn.pydata.org/">Seaborn Docs</a><br>
</li>
<li><a href="https://pandas.pydata.org/docs/user_guide/index.html">Pandas User Guide</a></li>
</ul>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>